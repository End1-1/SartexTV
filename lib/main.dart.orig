import 'dart:io';

import 'package:flutter/material.dart';
<<<<<<< HEAD
import 'package:sartex_tv/screen/ste.dart';
import 'package:sartex_tv/screen/tv/tv_screen.dart';
import 'package:sartex_tv/utils/consts.dart';
import 'package:sartex_tv/utils/prefs.dart';
import 'package:sartex_tv/utils/translator.dart';
=======
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:sartex/screen/app/app_bloc.dart';
import 'package:sartex/screen/barcum/barcum_screen.dart';
import 'package:sartex/screen/dashboard/dashboard_screen.dart';
import 'package:sartex/screen/departments/departments_screen.dart';
import 'package:sartex/screen/language_editor/language_screen.dart';
import 'package:sartex/screen/login/login_screen.dart';
import 'package:sartex/screen/login_pin/login_pin_screen.dart';
import 'package:sartex/screen/messages/screen.dart';
import 'package:sartex/screen/partners/partners_screen.dart';
import 'package:sartex/screen/patver_data/patver_data_screen.dart';
import 'package:sartex/screen/plan_and_production/plan_and_production_screen.dart';
import 'package:sartex/screen/product_type_code/product_type_code_screen.dart';
import 'package:sartex/screen/production_history/production_history_screen.dart';
import 'package:sartex/screen/products/products_screen.dart';
import 'package:sartex/screen/remains/remains_screen.dart';
import 'package:sartex/screen/returning/screen.dart';
import 'package:sartex/screen/sizes/sizes_screen.dart';
import 'package:sartex/screen/store_docs/store_docs_sreen.dart';
import 'package:sartex/screen/t_hashiv/thashiv_screen.dart';
import 'package:sartex/screen/tv/tv_screen.dart';
import 'package:sartex/screen/users/users_screen.dart';
import 'package:sartex/screen/users_role/users_role_screen.dart';
import 'package:sartex/utils/consts.dart';
import 'package:sartex/utils/http_sql.dart';
import 'package:sartex/utils/prefs.dart';
import 'package:sartex/utils/translator.dart';
>>>>>>> 4b2f057c1676cf81af02309e6a9ce5d4d14b0ec1
import 'package:shared_preferences/shared_preferences.dart';

import 'utils/sql.dart';

void main() async {

  WidgetsFlutterBinding.ensureInitialized();

  try {
    prefs = await SharedPreferences.getInstance();

  try {
    prefs.resetRoles();
  } catch (e) {
    print('prefs.resetRoles() error: $e');
  }

  try {
    await Sql.init();
  } catch (e) {
    print('Sql.init() error: $e');
  }

  try {
    L.language = prefs.getString(key_language) ?? key_language_am;
  } catch (e) {
    print('Language init error: $e');
  }
} catch (e, st) {
print('Unexpected error in main(): $e');
print(st);
}

runApp(MyApp());
}

class MyApp extends StatelessWidget {
  MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    //SystemChrome.setEnabledSystemUIOverlays(SystemUiOverlay.values);
    return MaterialApp(
<<<<<<< HEAD
        theme: ThemeData(
            fontFamily: 'Sylfaen',
            textTheme: const TextTheme(
              bodyLarge: TextStyle(fontSize: 12, color: Colors.black),
              bodySmall: TextStyle(fontSize: 12, color: Colors.black),
              bodyMedium: TextStyle(fontSize: 12, color: Colors.black),
            )),
        debugShowCheckedModeBanner: false,
        routes: {
          "/": (context) => TVScreen(false),
          route_tv: (context) =>  TVScreen(false)
=======
         theme: ThemeData(
           fontFamily: 'Sylfaen',
           textTheme: const TextTheme (
             bodyLarge: TextStyle(fontSize: 12, color: Colors.black),
             bodySmall: TextStyle(fontSize: 12, color: Colors.black),
             bodyMedium: TextStyle(fontSize: 12, color: Colors.black),
           )
         ),
        onGenerateRoute: (settings) {
          if (settings.name == route_thashiv) {
            return MaterialPageRoute(
                settings: settings,
                builder: (context) {
                  return BlocProvider(
                      create: (_) => AppBloc(GSIdle()),
                      child:
                          THashivScreen((settings.arguments ?? '') as String));
                });
          } else if (settings.name == route_barcum) {
            return MaterialPageRoute(
                settings: settings,
                builder: (context) {
                  return BlocProvider(
                      create: (_) => AppBloc(GSIdle()),
                      child: BarcumScreen(settings.arguments as int?));
                });
          } else if (settings.name == route_tv) {
            return MaterialPageRoute(
                settings: settings,
                builder: (context) {
                  return TVScreen();
                });
          }
          return null;
        },
        debugShowCheckedModeBanner: false,
        routes: {
          route_root: (context) => const SartexLogin(),
          route_dashboard: (context) => Dashboard(),
          route_patver_data: (context) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: PatverDataScreen()),

          route_production: (context) => PlanAndProductionScreen(),
          route_users: (context) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: UsersScreen()),
          route_sizes: (context) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: SizesScreen()),
          route_department: (context) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: DepartmentsScreen()),
          route_partners: (context) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: PartnersScreen()),
          route_product: (context) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: ProductsScreen()),
          route_language_editor: (context) => LanguageScreen(),
          route_users_role: (_) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: UsersRoleScreen()),
          route_remains: (_) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: RemainsScreen()),
          route_store_documents:(_) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: StoreDocsScreen()),
          route_production_history:(_) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: ProductionHistoryScreen()),
          route_product_type_code: (_) => BlocProvider(
              create: (_) => AppBloc(GSIdle()), child: ProductTypeCodeScreen()),
          route_notice: (_) => BlocProvider(create: (_) => AppBloc(GSIdle()), child: MessagesScreen()),
          // route_thashiv: (_) => BlocProvider(
          //     create: (_) => AppBloc(GSIdle()), child: THashivScreen(ModalRoute.of(context)?.settings.arguments as String?)),
          route_login_pin: (context) => LoginPinScreen(),
          route_returning: (_) => BlocProvider(create: (_) => AppBloc(GSIdle()), child: ReturningScreen())
>>>>>>> 4b2f057c1676cf81af02309e6a9ce5d4d14b0ec1
        });
  }
}

class MyHttpOverrides extends HttpOverrides {
  @override
  HttpClient createHttpClient(SecurityContext? context) {
    return super.createHttpClient(context)
      ..badCertificateCallback =
          (X509Certificate cert, String host, int port) => true;
  }
}
